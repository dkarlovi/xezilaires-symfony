#!/usr/bin/env php
<?php

use Xezilaires\Bridge\Symfony\AppKernel;
use Xezilaires\Bridge\Symfony\Console\Application;

if (version_compare('7.2.0', PHP_VERSION, '>')) {
    fwrite(STDERR, 'Xezilaires requires PHP 7.2+'.PHP_EOL);
    exit(1);
}

if (PHP_SAPI !== 'cli') {
    fwrite(STDERR, 'Xezilaires must be invoked via CLI version of PHP'.PHP_EOL);
    exit(1);
}

$autoLoaders = [
    // own auto-loader
    __DIR__.'/../vendor/autoload.php',

    // mono-repo auto-loader
    __DIR__.'/../../../../vendor/autoload.php',
];

$found = false;
foreach ($autoLoaders as $autoLoader) {
    if (true === file_exists($autoLoader)) {
        /* @noinspection PhpIncludeInspection */
        include $autoLoader;

        $found = true;
    }
}
if ($found === false) {
    fwrite(STDERR, 'You must set up the project dependencies using `composer install`'.PHP_EOL);
}

if (false === ini_get('date.timezone')) {
    ini_set('date.timezone', 'UTC');
}

$kernel = new AppKernel('prod', false);
$kernel->boot();

$application = new Application($kernel);
$application->run();
